- ## 催办事件

**新增事件**

-- 沟通消息事件表，基本信息（新表）

-- 推送事件明细表，推送信息（原表）

select * from xp_cadre_push_event_info;（bizCode:expediteCommunicate，stage_code:expedite，type:expedite，type_name:催办）

-- 推送事件员工范围条件配置表（PersonnelRangeStrategyFactory计算逻辑）

select * from xp_cadre_push_event_employee_condition_config;

-- 推送事件员工范围条件关系表

select * from xp_cadre_push_event_employee_condition_rel;

-- 推送事件目标类型配置表（PushTargetStrategyFactory计算逻辑）

select * from xp_cadre_push_event_target_type;

-- 推送事件推送目标关系表

select * from xp_cadre_push_event_target_rel;

1. ## 定时任务触发生成推送名单

逻辑：

1. 查询下一次时间时间为当前分钟的未来两个小时的事件 
2. 产生生成名单的事件（select * from config_event_record where is_deleted = 0 and event_type = 'createPushEventRoster' ）
3. 消费生成名单的事件去真实生成名单

-- 推送事件执行明细表

select * from xp_cadre_push_event_handle_info;

-- 推送名单版本

select * from config_version where is_deleted = 0 and is_new = 1 and data_type like 'push_event_%';

![img](https://xiaopeng.feishu.cn/space/api/box/stream/download/asynccode/?code=NDVhZjc0NGNlN2RhMTgyYzc4MWMwNDM1ODNlNTc0YmZfcnRPNmhRRUZqTDZsczJmWXVBMFlDMWFUTWVtRDNjZlhfVG9rZW46RnM4TmJmMGdTb0FjM0p4RWtjSWNiMHZUblBlXzE3NTgxODUyMDQ6MTc1ODE4ODgwNF9WNA)

1. ## 消息推送

查询时间表下次执行的时间为当前分钟，将这些事件最新版本发送名单取出来，进行发送。

**正常推送**

-- 消息推送记录

select * from config_task_record where task_type = 'pushEventMessageToIron' ;

![img](https://xiaopeng.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGYxY2ZiM2NkYWRiODkxYTI0OWViZTY2NmZjM2Q5YTRfWGk3OENVclp0VndJWXpnY0JkZk9MdEV6VWJ6UlVBb21fVG9rZW46UHdYcmJGQXVJb2Q3d2l4VzJGaWNDYTRBbmVoXzE3NTgxODUyMDQ6MTc1ODE4ODgwNF9WNA)

测试推送

![img](https://xiaopeng.feishu.cn/space/api/box/stream/download/asynccode/?code=ZGI5YTBiNGYxNjVkZjM4YTU4NzZhNTgwMGFmODVlNzNfNE5xTk54b2JXTUVFQmE4TWgwRW8yb2ppaHFDVGJZazVfVG9rZW46VUZOamJ1NGwzbzMyYXR4cFM0YWNZSkQwbnNmXzE3NTgxODUyMDQ6MTc1ODE4ODgwNF9WNA)

-- 消息推送记录

select * from config_task_record where task_type = 'pushEventMessageToIron_DEBUG' ;

1. ## 权限

使用@XpFrontSafeCheck(operationCode = "")注解来控制接口权限。用一个class文件来统一管理landing的operationCode，参考com.xiaopeng.evi.cadre.core.prompt.constants.PromptOperationCodes

-- 角色配置

select * from config_role;

-- 规则的应用权限        

select * from config_ability_power_point where operation_code in ('landingListView','landingTemplateDownload','landingImport','landingPlanSummit','landingListExport','landingMenu');

-- 规则的角色权限

select * from config_role_power_point where power_point_code in ('landingListView','landingTemplateDownload','landingImport','landingPlanSummit','landingListExport','landingMenu','dataViewMenu');

select * from config_role_power_point where role_code in ('landing_plan_query','landing_plan_summit');

-- 规则的拦截

select * from config_sys_permission where operation_code in ('landingListView','landingTemplateDownload','landingImport','landingPlanSummit','landingListExport');
